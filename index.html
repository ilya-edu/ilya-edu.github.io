<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анализатор данных промышленного оборудования</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .description {
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .control-panel {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background-color: var(--primary);
        }
        
        .btn i {
            font-size: 1.2rem;
        }
        
        .program-info {
            background: white;
            padding: 15px;
            border-left: 4px solid var(--secondary);
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .program-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .program-path {
            color: var(--gray);
            font-family: monospace;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            padding: 20px;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .data-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        
        .data-label {
            font-weight: 500;
            color: var(--dark);
        }
        
        .data-value {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 15px;
        }
        
        .axis-data {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .axis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .axis-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .axis-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            text-align: center;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: var(--gray);
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Анализатор данных промышленного оборудования</h1>
            <p class="description">Визуализация данных работы оборудования с помощью интерактивных графиков и диаграмм</p>
        </header>
        
        <div class="control-panel">
            <div>
                <h3>Данные оборудования в реальном времени</h3>
                <p>Обновлено: <span id="update-time">-</span></p>
            </div>
            <button class="btn" id="update-btn">
                <i class="fas fa-sync-alt"></i> Обновить данные
            </button>
        </div>
        
        <div class="program-info">
            <div class="program-title">Текущая программа:</div>
            <div class="program-path" id="program-path">Не определена</div>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h3>Моточасы</h3>
                <div class="data-list" id="motor-hours">
                    <!-- Данные будут добавлены через JavaScript -->
                </div>
                <div class="chart-container">
                    <canvas id="restartChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h3>Канал 1</h3>
                <div class="data-list" id="channel1-data">
                    <!-- Данные будут добавлены через JavaScript -->
                </div>
                <div class="chart-container">
                    <canvas id="programProgressChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h3>Статус системы</h3>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="modeChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="axis-data">
            <h3>Положение осей</h3>
            <div class="axis-grid" id="axis-data">
                <!-- Данные будут добавлены через JavaScript -->
            </div>
        </div>
        
        <footer>
            <p>Промышленная система мониторинга © 2023</p>
        </footer>
    </div>

    <script>
        // Имитация данных с оборудования (в реальном приложении данные будут приходить с сервера)
        const equipmentData = {
            "data":[
                ["Моточасы",[
                    ["Время работы ядра (всего)","26:40:32"],
                    ["Время работы ядра (текущее)","7:9:3"],
                    ["Количество перезапусков ядра","86"],
                    ["Количество каналов","2"]
                ]],
                ["Канал 1",[
                    ["Время работы канала (всего)","4:54:44"],
                    ["Время работы канала (текущее)","4:27:12"],
                    ["Статус канала","Работа"],
                    ["Режим канала","Авто"],
                    ["Время работы программы","000:02:17"],
                    ["Процент выполнения программы","86%"],
                    ["Программа","/NC/examples/04_06.nc"]
                ]],
                ["Оси Канала 1",[
                    ["Перемещение по оси X","42,8099 мм"],
                    ["Перемещение по оси Y","-50,5937 мм"],
                    ["Перемещение по оси Z","0 мм"],
                    ["Перемещение по оси C","34,4552 мм"],
                    ["Перемещение по оси S2","-5072,3452 мм"]
                ]],
                ["Оси Канала 2",[
                    ["Перемещение по оси X","0 мм"],
                    ["Перемещение по оси Y","0 мм"],
                    ["Перемещение по оси Z","0 мм"],
                    ["Перемещение по оси S","0 мм"],
                    ["Перемещение по оси S2","0 мм"]
                ]]
            ]
        };

        // Переменные для хранения графиков
        let restartChart, programProgressChart, statusChart, modeChart;

        // Функция для обновления времени
        function updateTime() {
            const now = new Date();
            document.getElementById('update-time').textContent = 
                `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        }

        // Функция для преобразования времени в секунды
        function timeToSeconds(timeStr) {
            const parts = timeStr.split(':');
            return parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]);
        }

        // Функция для извлечения числового значения из строки
        function extractNumber(value) {
            const num = parseFloat(value.replace(/[^\d,-]/g, '').replace(',', '.'));
            return isNaN(num) ? 0 : num;
        }

        // Функция для отображения данных моточасов
        function displayMotorHours(data) {
            const container = document.getElementById('motor-hours');
            container.innerHTML = '';
            
            data.forEach(item => {
                const dataItem = document.createElement('div');
                dataItem.className = 'data-item';
                
                const label = document.createElement('span');
                label.className = 'data-label';
                label.textContent = item[0];
                
                const value = document.createElement('span');
                value.className = 'data-value';
                value.textContent = item[1];
                
                dataItem.appendChild(label);
                dataItem.appendChild(value);
                container.appendChild(dataItem);
            });
        }

        // Функция для отображения данных канала
        function displayChannelData(data) {
            const container = document.getElementById('channel1-data');
            container.innerHTML = '';
            
            data.forEach(item => {
                const dataItem = document.createElement('div');
                dataItem.className = 'data-item';
                
                const label = document.createElement('span');
                label.className = 'data-label';
                label.textContent = item[0];
                
                const value = document.createElement('span');
                value.className = 'data-value';
                value.textContent = item[1];
                
                dataItem.appendChild(label);
                dataItem.appendChild(value);
                container.appendChild(dataItem);
                
                // Сохраняем путь к программе
                if (item[0] === 'Программа') {
                    document.getElementById('program-path').textContent = item[1];
                }
            });
        }

        // Функция для отображения данных осей
        function displayAxisData(axis1, axis2) {
            const container = document.getElementById('axis-data');
            container.innerHTML = '';
            
            // Создаем карточки для осей канала 1
            const axis1Card = document.createElement('div');
            axis1Card.className = 'axis-card';
            axis1Card.innerHTML = '<h4>Канал 1</h4>';
            
            axis1.forEach(item => {
                const dataItem = document.createElement('div');
                dataItem.className = 'data-item';
                
                const label = document.createElement('span');
                label.className = 'data-label';
                label.textContent = item[0];
                
                const value = document.createElement('span');
                value.className = 'data-value';
                value.textContent = item[1];
                
                dataItem.appendChild(label);
                dataItem.appendChild(value);
                axis1Card.appendChild(dataItem);
            });
            
            // Создаем карточки для осей канала 2
            const axis2Card = document.createElement('div');
            axis2Card.className = 'axis-card';
            axis2Card.innerHTML = '<h4>Канал 2</h4>';
            
            axis2.forEach(item => {
                const dataItem = document.createElement('div');
                dataItem.className = 'data-item';
                
                const label = document.createElement('span');
                label.className = 'data-label';
                label.textContent = item[0];
                
                const value = document.createElement('span');
                value.className = 'data-value';
                value.textContent = item[1];
                
                dataItem.appendChild(label);
                dataItem.appendChild(value);
                axis2Card.appendChild(dataItem);
            });
            
            container.appendChild(axis1Card);
            container.appendChild(axis2Card);
        }

        // Функция для создания графика перезапусков
        function createRestartChart(data) {
            const ctx = document.getElementById('restartChart').getContext('2d');
            
            if (restartChart) {
                restartChart.destroy();
            }
            
            // Находим данные о перезапусках
            const restartData = data.find(item => item[0] === 'Количество перезапусков ядра');
            const restartCount = restartData ? parseInt(restartData[1]) : 0;
            
            restartChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Перезапуски'],
                    datasets: [{
                        label: 'Количество перезапусков',
                        data: [restartCount],
                        backgroundColor: '#3498db',
                        borderColor: '#2980b9',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Количество'
                            }
                        }
                    }
                }
            });
        }

        // Функция для создания графика прогресса программы
        function createProgramProgressChart(data) {
            const ctx = document.getElementById('programProgressChart').getContext('2d');
            
            if (programProgressChart) {
                programProgressChart.destroy();
            }
            
            // Находим данные о прогрессе программы
            const progressData = data.find(item => item[0] === 'Процент выполнения программы');
            const progressValue = progressData ? extractNumber(progressData[1]) : 0;
            
            programProgressChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Выполнено', 'Осталось'],
                    datasets: [{
                        data: [progressValue, 100 - progressValue],
                        backgroundColor: [
                            '#2ecc71',
                            '#ecf0f1'
                        ],
                        borderColor: [
                            '#27ae60',
                            '#bdc3c7'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Прогресс выполнения программы'
                        }
                    }
                }
            });
        }

        // Функция для создания графиков статуса и режима
        function createStatusAndModeChannels(data) {
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            const modeCtx = document.getElementById('modeChart').getContext('2d');
            
            if (statusChart) {
                statusChart.destroy();
            }
            if (modeChart) {
                modeChart.destroy();
            }
            
            // Находим данные о статусе и режиме
            const statusData = data.find(item => item[0] === 'Статус канала');
            const modeData = data.find(item => item[0] === 'Режим канала');
            
            // График статуса
            statusChart = new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: ['Работа', 'Останов'],
                    datasets: [{
                        data: [statusData && statusData[1] === 'Работа' ? 80 : 20, 20],
                        backgroundColor: [
                            '#2ecc71',
                            '#e74c3c'
                        ],
                        borderColor: [
                            '#27ae60',
                            '#c0392b'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Статус канала'
                        }
                    }
                }
            });
            
            // График режима
            modeChart = new Chart(modeCtx, {
                type: 'polarArea',
                data: {
                    labels: ['Авто', 'Ручной'],
                    datasets: [{
                        data: [modeData && modeData[1] === 'Авто' ? 70 : 30, 30],
                        backgroundColor: [
                            '#3498db',
                            '#f39c12'
                        ],
                        borderColor: [
                            '#2980b9',
                            '#e67e22'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Режим работы'
                        }
                    }
                }
            });
        }

        // Функция для обновления всех данных
        function updateAllData() {
            // Обновляем время
            updateTime();
            
            // Извлекаем данные из JSON
            const motorHoursData = equipmentData.data[0][1];
            const channel1Data = equipmentData.data[1][1];
            const axis1Data = equipmentData.data[2][1];
            const axis2Data = equipmentData.data[3][1];
            
            // Отображаем данные
            displayMotorHours(motorHoursData);
            displayChannelData(channel1Data);
            displayAxisData(axis1Data, axis2Data);
            
            // Создаем графики
            createRestartChart(motorHoursData);
            createProgramProgressChart(channel1Data);
            createStatusAndModeChannels(channel1Data);
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Первоначальная загрузка данных
            updateAllData();
            
            // Обработчик кнопки обновления
            document.getElementById('update-btn').addEventListener('click', function() {
                // В реальном приложении здесь будет запрос к серверу
                // Для демонстрации просто обновим отображение
                updateAllData();
                
                // Добавляем анимацию на кнопку
                this.classList.add('rotating');
                setTimeout(() => {
                    this.classList.remove('rotating');
                }, 1000);
            });
            
            // Имитация периодического обновления данных
            setInterval(updateAllData, 60000); // Обновление каждую минуту
        });

        // Добавляем Font Awesome для иконок
        document.head.innerHTML += '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">';
        
        // Стиль для анимации кнопки
        document.head.innerHTML += `
        <style>
            .rotating {
                animation: rotate 0.5s ease;
            }
            
            @keyframes rotate {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        </style>
        `;
    </script>
</body>
</html>
